<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <title>JOEL XMD YT Downloader</title>

  <link rel="icon" href="https://raw.githubusercontent.com/joeljamestech2/JOEL-XMD-DOWNLOADER-/refs/heads/main/IMAGES/images%20(1).png" />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

  <style>
    body {
      margin: 0;
      font-family: 'JetBrains Mono', monospace;
      background: #000;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }

    h1 {
      font-size: 1.4rem;
      color: #00d9ff;
      margin-bottom: 1rem;
    }

    .search-container {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #111;
      border-radius: 25px;
      padding: 8px 12px;
      max-width: 600px;
      margin: 0 auto;
      height: 30px;
    }

    .material-icons { font-size: 22px; }

    .back-arrow {
      color: #ccc;
      cursor: pointer;
      margin-right: 10px;
    }

    .search-input {
      flex: 1;
      border: none;
      background: transparent;
      outline: none;
      font-size: 0.95rem;
      color: #fff;
    }

    .icon-button {
      background-color: #222;
      border-radius: 50%;
      width: 46px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 8px;
      cursor: pointer;
    }

    .icon-button:hover { background-color: #333; }

    .results {
      margin-top: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .card {
      background: #111;
      border-radius: 8px;
      padding: 0.5rem;
      text-align: left;
      font-size: 0.85rem;
    }

    .card img {
      width: 100%;
      border-radius: 4px;
    }

    .meta p {
      margin: 3px 0;
      color: #ccc;
    }

    .actions {
      margin-top: 0.5rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    /* Cylinder buttons with monospace font */
    .actions button {
      background: #00d9ff;
      color: #000;
      padding: 0.5rem 1rem;
      font-weight: bold;
      font-size: 0.85rem;
      border-radius: 50px;
      cursor: pointer;
      font-family: 'JetBrains Mono', monospace;
      border: none;
      transition: background 0.3s, transform 0.2s;
    }

    .actions button:hover {
      background: #00ffff;
      transform: scale(1.05);
    }

    .error {
      color: red;
      margin-top: 0.5rem;
      font-size: 0.85rem;
    }

    .loading {
      font-size: 0.8rem;
      color: #00d9ff;
      margin-top: 5px;
    }

    /* MP3 preview player */
    .audio-player {
      margin-top: 0.5rem;
      background: #222;
      padding: 0.5rem;
      border-radius: 12px;
    }

    .audio-player audio {
      width: 100%;
      outline: none;
      border-radius: 8px;
      background: #000;
    }
  </style>
</head>
<body>

<h1>JOEL XMD YT DOWNLOADER</h1>

<div class="search-container">
  <span class="material-icons back-arrow" onclick="window.location.href='https://joel-xmd-downloader.vercel.app/youtube'">arrow_back</span>
  <input class="search-input" id="query" placeholder="Enter search term or YouTube url" />
  <div class="icon-button" onclick="searchVideos()">
    <span class="material-icons">search</span>
  </div>
  <div class="icon-button">
    <span class="material-icons">mic</span>
  </div>
</div>

<div class="error" id="error"></div>
<div class="results" id="results"></div>

<script>
const input = document.getElementById("query");
const results = document.getElementById("results");
const error = document.getElementById("error");

// Auto-search trending musics on page load
window.addEventListener("load", () => {
  input.value = "trending musics";
  searchVideos();
});

input.addEventListener("keydown", e => {
  if (e.key === "Enter") searchVideos();
});

async function searchVideos() {
  const query = input.value.trim();
  results.innerHTML = '';
  error.textContent = '';

  if (!query) return;

  const loading = document.createElement("div");
  loading.className = "loading";
  loading.textContent = "Searching trending musics...";
  results.appendChild(loading);

  try {
    const api = `https://corsproxy.io/?${encodeURIComponent(
      `https://my-rest-apis-six.vercel.app/yts?query=${encodeURIComponent(query)}`
    )}`;

    const res = await fetch(api);
    const json = await res.json();
    results.innerHTML = '';

    if (!json.results || json.results.length === 0) {
      error.textContent = "❌ No results found.";
      return;
    }

    json.results.slice(0, 20).forEach(video => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${video.thumbnail}">
        <div class="meta">
          <p><strong>${video.title}</strong></p>
          <p>${video.author}</p>
          <p>${video.duration}</p>
        </div>
        <div class="actions">
          <button onclick="downloadMedia('${video.url}','mp3',this)">download audio</button>
          <button onclick="downloadMedia('${video.url}','mp4',this)">download video</button>
        </div>
        <div class="audio-player" id="player-${video.url.replace(/\W/g,'')}">
          <audio controls></audio>
        </div>
      `;

      results.appendChild(card);

      // Load MP3 preview
      const audioEl = card.querySelector('audio');
      fetch(`https://corsproxy.io/?${encodeURIComponent(`https://iamtkm.vercel.app/downloaders/ytmp3?apikey=tkm&url=${encodeURIComponent(video.url)}`)}`)
        .then(res => res.json())
        .then(data => {
          if (data?.status && data?.data?.url) {
            audioEl.src = data.data.url;
          }
        }).catch(()=>{});
    });

  } catch {
    error.textContent = "❌ Failed to fetch videos.";
  }
}

async function downloadMedia(url, format, button) {
  button.disabled = true;

  try {
    const api = `https://corsproxy.io/?${encodeURIComponent(
      `https://iamtkm.vercel.app/downloaders/yt${format}?apikey=tkm&url=${encodeURIComponent(url)}`
    )}`;

    const res = await fetch(api);
    const json = await res.json();

    if (json?.status && json?.data?.url) {
      window.location.href = json.data.url;
    } else {
      alert("❌ Download failed");
    }
  } catch {
    alert("❌ Error downloading");
  } finally {
    button.disabled = false;
  }
}
</script>

</body>
</html>
